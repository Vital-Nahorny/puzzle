(()=>{"use strict";(()=>{function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const t=function t(i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e(this,"init",(function(){var e=n.time.sec<=9?"0".concat(n.time.sec):String(n.time.sec),t=n.time.min<=9?"0".concat(n.time.min):String(n.time.min);n.textElemTime.innerText="Time ".concat(t," : ").concat(e)})),e(this,"refreshTime",(function(){var e=n.time.sec<=9?"0".concat(n.time.sec):String(n.time.sec),t=n.time.min<=9?"0".concat(n.time.min):String(n.time.min);n.time.sec+=1,60===n.time.sec&&(n.time.min+=1,n.time.sec=0),n.textElemTime.innerText="Time ".concat(t," : ").concat(e)})),e(this,"clearTime",(function(){n.time.sec=0,n.time.min=0})),e(this,"getTime",(function(){return{min:n.time.min,sec:n.time.sec}})),e(this,"startTimer",(function(){n.timer||(n.timer=setInterval(n.refreshTime,1e3))})),e(this,"stopTimer",(function(){clearInterval(n.timer),n.timer=null})),e(this,"setTime",(function(e){var t=e.sec,i=e.min;n.time.sec=t,n.time.min=i})),this.textElemTime=i,this.time={min:0,sec:0},this.timer=null};function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return i}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function l(e,t,i,s){var a,l=null;try{l=document.createElement(e)}catch(e){throw new Error("Unable to create HTMLElement! Give a proper tag name")}t&&(a=l.classList).add.apply(a,o(t.split(" "))),i&&Array.isArray(i)?i.forEach((function(e){return e&&l.appendChild(e)})):i&&"object"===r(i)?l.appendChild(i):i&&"string"==typeof i&&(l.innerHTML=i),s&&s.appendChild(l);for(var c=arguments.length,p=new Array(c>4?c-4:0),m=4;m<c;m++)p[m-4]=arguments[m];return p.length&&p.forEach((function(e){var t=n(e,2),i=t[0],r=t[1];""===r&&l.setAttribute(i,""),i.match(/value|id|placeholder|cols|rows|autocorrect|spellcheck|src|alt/)?l.setAttribute(i,r):l.dataset[i]=r})),l}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements={gameField:null,info:null,control:null,fieldSize:null,topScore:null,chips:[],emptyChip:null,count:null,timer:null},this.properties={imgNum:0,topResults:[],sound:!0,count:0,chipSize:100,fieldSize:8},this.gameTimer=null}var n,r;return n=e,(r=[{key:"init",value:function(){this.elements.info=l("div","info",this.renderInfoBlock(),document.body),this.elements.control=l("div","control",this.renderControlsBlock(),document.body),this.elements.topScore=l("div","top-score",this.renderScoreBlock(),document.body),this.elements.gameField=l("div","game-field",null,document.body),this.elements.gameField.appendChild(this.renderGameField()),this.createEventListeners()}},{key:"renderInfoBlock",value:function(){var e=document.createDocumentFragment();if(this.elements.timer=l("div","timer",null,e),this.elements.count=l("div","count","Moves: ".concat(this.properties.count),e),this.gameTimer=new t(this.elements.timer),this.gameTimer.init(),this.gameTimer.startTimer(),localStorage.time){var i=JSON.parse(localStorage.time);this.gameTimer.setTime(i)}return localStorage.count&&(this.properties.count=Number(localStorage.count)),e}},{key:"renderControlsBlock",value:function(){var e=this,t=document.createDocumentFragment();this.elements.fieldSize=l("select","filed-size",'<option value="3">3x3</option>\n      <option value="4" selected>4x4</option>\n      <option value="5">5x5</option>\n      <option value="6">6x6</option>\n      <option value="7">7x7</option>\n      <option value="8">8x8</option>',t),l("button","btn btn-primary","New game",t,["type","button"]).addEventListener("click",(function(){e.createNewGame()}));var i=l("button","btn btn-primary btn-floating",null,t);return i.innerHTML=this.properties.sound?'<i class="fas fa-volume-up fa-lg"></i>':'<i class="fas fa-volume-mute fa-lg"></i>',i.addEventListener("click",(function(){e.properties.sound=!e.properties.sound,i.innerHTML=e.properties.sound?'<i class="fas fa-volume-up fa-lg"></i>':'<i class="fas fa-volume-mute fa-lg"></i>'})),t}},{key:"renderScoreBlock",value:function(){var e=document.createDocumentFragment();return l("h3","top-score__title","Top 10 scores:",e),localStorage.topResults&&(this.properties.topResults=JSON.parse(localStorage.topResults),this.properties.topResults.forEach((function(t){l("div","top-score__result","Counts:  ".concat(t.count,"  Time  ").concat(t.min,":").concat(t.sec),e)}))),e}},{key:"renderGameField",value:function(){var e=this,t=document.createDocumentFragment();localStorage.fieldSize?this.properties.fieldSize=+localStorage.fieldSize:this.properties.fieldSize=this.elements.fieldSize.value;var n=Math.floor(10*Math.random());this.properties.imgNum=localStorage.imgNum?localStorage.imgNum:n;var r=localStorage.chipLayout?JSON.parse(localStorage.chipLayout):function(e){for(var t=Math.pow(e,2),n=(u=Array(t).keys(),function(e){if(Array.isArray(e))return i(e)}(u)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(u)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(u)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){return e+1})),r=0;0===r;){n.sort((function(){return Math.random()-.5}));var o=void 0,s=n.indexOf(t);e%2!=0?o=0:(s<=e-1&&(o=1),s>e-1&&s<=2*e-1&&(o=2),s>2*e-1&&s<=3*e-1&&(o=3),s>3*e-1&&s<=4*e-1&&(o=4),s>4*e-1&&s<=5*e-1&&(o=5),s>5*e-1&&s<=6*e-1&&(o=6),s>6*e-1&&s<=7*e-1&&(o=7),s>7*e-1&&s<=8*e-1&&(o=8));for(var a=0,l=0;l<15;l+=1){var c=n[l];if(0!==c)for(var p=l+1;p<=15;p+=1){var m=n[p];c>m&&0!==m&&(a+=1)}}(a+=o)%2==0&&(r=1)}var u;return n}(this.properties.fieldSize),o=this.elements.gameField.clientWidth;return this.properties.chipSize=o/this.properties.fieldSize,r.forEach((function(i,n){e.createChipElement(n,i,t)})),t}},{key:"createNewGame",value:function(){this.properties.count=0,this.elements.count.textContent="Moves: ".concat(this.properties.count),this.elements.topScore.innerHTML="",this.elements.topScore.appendChild(this.renderScoreBlock()),this.elements.gameField.innerHTML="",this.elements.gameField.removeAttribute("style"),this.elements.chips=[],localStorage.clear(),this.elements.gameField.appendChild(this.renderGameField()),this.gameTimer.clearTime(),this.gameTimer.startTimer()}},{key:"moveChips",value:function(e){var t=this.elements.chips.find((function(t){return t.value===+e}));if(!(Math.abs(this.elements.emptyChip.left-t.left)+Math.abs(this.elements.emptyChip.top-t.top)>1)){t.element.style.left="".concat(this.elements.emptyChip.left*this.properties.chipSize,"px"),t.element.style.top="".concat(this.elements.emptyChip.top*this.properties.chipSize,"px"),this.elements.emptyChip.element.style.left="".concat(t.left*this.properties.chipSize,"px"),this.elements.emptyChip.element.style.top="".concat(t.top*this.properties.chipSize,"px");var i,n=this.elements.emptyChip.left,r=this.elements.emptyChip.top;this.elements.emptyChip.left=t.left,this.elements.emptyChip.top=t.top,t.left=n,t.top=r,this.properties.count+=1,this.elements.count.textContent="Moves: ".concat(this.properties.count),this.saveGame(),this.properties.sound&&((i=new Audio).src="./audio/switch.mp3",i.autoplay=!0)}}},{key:"winCheck",value:function(){var e=this;if(this.elements.chips.every((function(t){var i=t.top*e.properties.fieldSize+t.left+1;return t.value===i}))){this.gameTimer.stopTimer();var t=this.gameTimer.getTime();this.elements.gameField.innerHTML="Ура! Вы решили головоломку за ".concat(t.min," минут ").concat(t.sec," секунд и ").concat(this.properties.count," ходов."),this.elements.gameField.style.backgroundImage="url(./img/".concat(this.properties.imgNum,".jpg)"),this.elements.gameField.style.backgroundSize="".concat(this.properties.chipSize*this.properties.fieldSize,"px");var i={min:t.min,sec:t.sec,count:this.properties.count};this.properties.topResults.push(i),this.properties.topResults.sort((function(e,t){return e.count>t.count?1:-1})),this.properties.topResults=this.properties.topResults.slice(0,10),localStorage.topResults=JSON.stringify(this.properties.topResults),this.elements.topScore.innerHTML="",this.elements.topScore.appendChild(this.renderScoreBlock())}}},{key:"saveGame",value:function(){var e,t=this,i=function(e){if(Array.isArray(e))return c(e)}(e=this.elements.chips)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=[];i.forEach((function(e){var i=e;i.index=i.top*t.properties.fieldSize+i.left})),i.sort((function(e,t){return e.index>t.index?1:-1})),i.forEach((function(e){n.push(e.value)})),localStorage.chipLayout=JSON.stringify(n),localStorage.fieldSize=this.properties.fieldSize,localStorage.imgNum=this.properties.imgNum,localStorage.count=this.properties.count,localStorage.time=JSON.stringify(this.gameTimer.getTime())}},{key:"loadGame",value:function(){this.elements.chips=localStorage.getItem("arr")}},{key:"createChipElement",value:function(e,t,i){var n=Math.pow(this.properties.fieldSize,2),r=document.createElement("div"),o=e%this.properties.fieldSize,s=(e-o)/this.properties.fieldSize,a=(t-1)%this.properties.fieldSize,l=(t-1-a)/this.properties.fieldSize;switch(r.style.left="".concat(o*this.properties.chipSize,"px"),r.style.top="".concat(s*this.properties.chipSize,"px"),r.style.width="".concat(this.properties.chipSize,"px"),r.style.height="".concat(this.properties.chipSize,"px"),this.elements.chips.push({top:s,left:o,element:r,value:t}),t){case n:r.classList.add("puzzle__chip-empty"),this.elements.emptyChip=this.elements.chips[e];break;default:r.classList.add("puzzle__chip"),r.style.backgroundImage="url(./img/".concat(this.properties.imgNum,".jpg)"),r.style.backgroundSize="".concat(this.properties.chipSize*this.properties.fieldSize,"px"),r.style.backgroundPosition="left ".concat(-a*this.properties.chipSize,"px top ").concat(-l*this.properties.chipSize,"px"),r.setAttribute("draggable",!0),r.textContent=t}i.appendChild(r)}},{key:"createEventListeners",value:function(){var e=this;this.elements.gameField.addEventListener("click",(function(t){var i=t.target;i.classList.contains("puzzle__chip")&&(e.moveChips(i.textContent),e.winCheck())})),this.elements.gameField.addEventListener("dragstart",(function(e){var t=e.target;t.classList.contains("puzzle__chip")&&(e.dataTransfer.setData("value",t.textContent),setTimeout((function(){t.classList.add("hide")}),0))})),this.elements.gameField.addEventListener("dragend",(function(e){var t=e.target;t.classList.contains("puzzle__chip")&&t.classList.remove("hide")})),this.elements.gameField.addEventListener("dragover",(function(e){e.preventDefault()})),this.elements.gameField.addEventListener("dragenter",(function(e){e.preventDefault()})),this.elements.gameField.addEventListener("drop",(function(t){if(t.preventDefault(),t.target.classList.contains("puzzle__chip-empty")){var i=t.dataTransfer.getData("value");e.moveChips(i),e.winCheck()}}))}}])&&p(n.prototype,r),e}();window.addEventListener("DOMContentLoaded",(function(){(new m).init()}))})()})();